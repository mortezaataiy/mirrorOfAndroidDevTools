# مستند طراحی: سیستم نصب و تست کامپوننت‌های Android

## نمای کلی

این سیستم یک ساختار منظم برای نصب، بررسی و تست کامپوننت‌های Android Development Tools ایجاد می‌کند. هر کامپوننت در پوشه‌ای جداگانه با سه اسکریپت مستقل قرار می‌گیرد.

## معماری

### عملکرد کاملاً آفلاین

این سیستم طراحی شده تا کاملاً بدون اتصال اینترنت کار کند:

- **منبع فایل‌ها**: تمام فایل‌های مورد نیاز از پوشه `downloaded` خوانده می‌شوند
- **بدون درخواست شبکه**: هیچ اسکریپتی تلاش برای دسترسی به اینترنت نمی‌کند
- **اعتبارسنجی محلی**: تمام بررسی‌ها بر اساس فایل‌های محلی انجام می‌شود
- **پیکربندی محلی**: تمام تنظیمات از فایل‌های محلی یا متغیرهای سیستم خوانده می‌شود

### ساختار کلی پوشه‌ها

```
installation-scripts/
├── jdk17/
│   ├── 01-check-prerequisites.ps1
│   ├── 02-install-component.ps1
│   └── 03-test-installation.ps1
├── android-studio/
│   ├── 01-check-prerequisites.ps1
│   ├── 02-install-component.ps1
│   └── 03-test-installation.ps1
├── gradle/
│   ├── 01-check-prerequisites.ps1
│   ├── 02-install-component.ps1
│   └── 03-test-installation.ps1
├── commandline-tools/
│   ├── 01-check-prerequisites.ps1
│   ├── 02-install-component.ps1
│   └── 03-test-installation.ps1
├── platform-tools/
│   ├── 01-check-prerequisites.ps1
│   ├── 02-install-component.ps1
│   └── 03-test-installation.ps1
├── build-tools/
│   ├── 01-check-prerequisites.ps1
│   ├── 02-install-component.ps1
│   └── 03-test-installation.ps1
├── sdk-platforms/
│   ├── 01-check-prerequisites.ps1
│   ├── 02-install-component.ps1
│   └── 03-test-installation.ps1
├── system-images/
│   ├── 01-check-prerequisites.ps1
│   ├── 02-install-component.ps1
│   └── 03-test-installation.ps1
├── repositories/
│   ├── 01-check-prerequisites.ps1
│   ├── 02-install-component.ps1
│   └── 03-test-installation.ps1
└── common/
    ├── Logger.ps1
    ├── FileValidator.ps1
    └── EnvironmentManager.ps1
```

## کامپوننت‌ها و رابط‌ها

### 1. اسکریپت بررسی پیش‌نیازها (01-check-prerequisites.ps1)

**مسئولیت‌ها:**
- بررسی وجود فایل‌های نصب در پوشه `downloaded`
- اعتبارسنجی پیش‌نیازهای سیستم (بدون اتصال اینترنت)
- بررسی کامپوننت‌های وابسته که قبلاً نصب شده‌اند

**رابط ورودی:**
- مسیر فایل‌های دانلود شده (پوشه `downloaded`)
- تنظیمات کامپوننت (محلی)

**رابط خروجی:**
- وضعیت موفقیت/شکست
- لیست مشکلات یافت شده

### 2. اسکریپت نصب (02-install-component.ps1)

**مسئولیت‌ها:**
- استخراج فایل‌های فشرده از پوشه `downloaded` (آفلاین)
- کپی فایل‌ها به مقصد نهایی
- تنظیم متغیرهای محیطی (محلی)
- ایجاد فایل‌های پیکربندی (بدون دسترسی شبکه)

**رابط ورودی:**
- مسیر فایل‌های منبع (پوشه `downloaded`)
- مسیر نصب هدف (محلی)
- تنظیمات نصب (محلی)

**رابط خروجی:**
- وضعیت نصب
- مسیر نصب نهایی
- لاگ عملیات

### 3. اسکریپت تست (03-test-installation.ps1)

**مسئولیت‌ها:**
- تست اجرای فایل‌های اجرایی (محلی)
- بررسی نسخه نصب شده (بدون اتصال اینترنت)
- تست عملکرد پایه (آفلاین)
- تولید گزارش تست (محلی)

**رابط ورودی:**
- مسیر نصب کامپوننت (محلی)
- پارامترهای تست (محلی)

**رابط خروجی:**
- نتایج تست
- گزارش جزئیات
- وضعیت کلی

## مدل‌های داده

### ComponentInfo
```powershell
class ComponentInfo {
    [string]$Name
    [string]$Version
    [string]$SourceFile
    [string]$InstallPath
    [string[]]$Dependencies
    [hashtable]$EnvironmentVariables
    [string[]]$ExecutableFiles
}
```

### InstallationResult
```powershell
class InstallationResult {
    [bool]$Success
    [string]$Message
    [string[]]$Errors
    [string]$LogPath
    [datetime]$Timestamp
}
```

### TestResult
```powershell
class TestResult {
    [string]$ComponentName
    [bool]$Success
    [hashtable]$TestResults
    [string[]]$FailedTests
    [string]$Summary
}
```

## خصوصیات صحت

*خصوصیت یک ویژگی یا رفتاری است که باید در تمام اجراهای معتبر سیستم برقرار باشد - در واقع، بیانیه‌ای رسمی درباره آنچه سیستم باید انجام دهد.*

### خصوصیت ۱: یکپارچگی فایل‌ها
*برای هر* فایل فشرده که توسط سیستم پردازش می‌شود، اعتبارسنجی فایل باید قبل از استخراج موفقیت‌آمیز باشد
**اعتبارسنجی: الزامات ۲.۱، ۲.۲**

### خصوصیت ۲: استقلال اسکریپت‌ها
*برای هر* اسکریپت در سیستم، اجرای آن نباید به وضعیت اجرای سایر اسکریپت‌ها وابسته باشد
**اعتبارسنجی: الزامات ۶.۱، ۶.۲**

### خصوصیت ۳: تست‌پذیری نصب
*برای هر* کامپوننت نصب شده، اجرای تست باید وضعیت صحیح نصب را تأیید کند
**اعتبارسنجی: الزامات ۴.۱، ۴.۲، ۴.۳**

### خصوصیت ۴: مدیریت خطا
*برای هر* خطای رخ داده در سیستم، پیام خطای واضح و قابل فهم باید تولید شود
**اعتبارسنجی: الزامات ۲.۳، ۳.۴، ۴.۵**

### خصوصیت ۵: عملکرد آفلاین
*برای هر* عملیات سیستم، هیچ درخواست شبکه‌ای نباید ارسال شود
**اعتبارسنجی: الزامات ۸.۱، ۸.۲، ۸.۴**

## مدیریت خطا

### انواع خطاها
1. **خطاهای فایل**: فایل موجود نیست، فایل خراب است
2. **خطاهای سیستم**: مجوزهای ناکافی، فضای دیسک ناکافی
3. **خطاهای وابستگی**: پیش‌نیاز موجود نیست
4. **خطاهای نصب**: شکست در استخراج، شکست در کپی فایل‌ها

### استراتژی مدیریت خطا
- تمام خطاها باید لاگ شوند
- پیام‌های خطا باید به زبان فارسی باشند
- در صورت خطا، عملیات باید متوقف شود
- راهنمایی برای حل مشکل ارائه شود

## استراتژی تست

### رویکرد دوگانه تست
- **تست‌های واحد**: تست عملکرد هر اسکریپت به صورت جداگانه
- **تست‌های خصوصیت**: تست خصوصیات کلی سیستم در تمام ورودی‌ها

### تنظیمات تست خصوصیت‌محور
- حداقل ۱۰۰ تکرار برای هر تست خصوصیت
- هر تست خصوصیت باید به خصوصیت طراحی مربوطه ارجاع دهد
- فرمت برچسب: **Feature: android-component-installer, Property {number}: {property_text}**

### کامپوننت‌های تست
1. **JDK 17**: تست نصب و تنظیم JAVA_HOME
2. **Android Studio**: تست نصب و اجرای اولیه
3. **Gradle**: تست نصب و اجرای دستورات پایه
4. **Command Line Tools**: تست نصب و دسترسی به sdkmanager
5. **Platform Tools**: تست نصب و اجرای adb
6. **Build Tools**: تست نصب و دسترسی به aapt
7. **SDK Platforms**: تست نصب و تشخیص API levels
8. **System Images**: تست نصب و تشخیص emulator images
9. **Repositories**: تست نصب و دسترسی به Maven artifacts

### تعادل تست‌های واحد
- تست‌های واحد برای مثال‌های خاص و موارد لبه مفید هستند
- از نوشتن تست‌های واحد زیاد خودداری کنید - تست‌های خصوصیت‌محور ورودی‌های زیادی را پوشش می‌دهند
- تست‌های واحد باید روی موارد زیر متمرکز باشند:
  - مثال‌های خاص که رفتار صحیح را نشان می‌دهند
  - نقاط ادغام بین کامپوننت‌ها
  - موارد لبه و شرایط خطا
- تست‌های خصوصیت باید روی موارد زیر متمرکز باشند:
  - خصوصیات کلی که برای تمام ورودی‌ها برقرار است
  - پوشش جامع ورودی از طریق تصادفی‌سازی