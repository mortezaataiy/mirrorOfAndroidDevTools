# سند الزامات

## مقدمه

این مشخصات الزامات ایجاد یک GitHub Actions workflow جامع و نهایی را تعریف می‌کند که تمام ابزارهای توسعه اندروید مورد نیاز برای توسعه کاملاً آفلاین را دانلود، اعتبارسنجی و بسته‌بندی می‌کند. این workflow باید قوی، دفاعی و شامل اعتبارسنجی جامع باشد تا اطمینان حاصل شود که تمام کامپوننت‌های دانلود شده سالم و آماده استفاده آفلاین هستند.

## واژه‌نامه

- **Workflow**: فایل YAML GitHub Actions که دانلود و اعتبارسنجی را خودکار می‌کند
- **Component**: ابزار توسعه اندروید یا بخش SDK منفرد (JDK، Gradle، SDK Platform و غیره)
- **Artifact**: GitHub Actions artifact حاوی فایل‌های کامپوننت اعتبارسنجی شده
- **Validation**: فرآیند بررسی یکپارچگی فایل، اندازه و ساختار ZIP
- **Offline_Setup**: محیط توسعه اندروید کامل که پس از دانلود اولیه بدون اینترنت کار می‌کند

## الزامات

### الزام ۱: پوشش کامل کامپوننت‌ها

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم تمام کامپوننت‌های ضروری توسعه اندروید در یک workflow دانلود شوند تا همه چیز مورد نیاز برای توسعه آفلاین را داشته باشم.

#### معیارهای پذیرش

1. Workflow باید Android Studio 2022.3.1 (Giraffe) ویندوز x64 را دانلود کند
2. Workflow باید JDK 17 (فرمت ZIP ویندوز x64) را دانلود کند
3. Workflow باید Gradle نسخه‌های متعدد را دانلود کند:
   - Gradle 8.1 (سازگار با AGP 8.x)
   - Gradle 8.0.2 (سازگار با AGP 8.x)
   - Gradle 7.6.3 (سازگار با AGP 7.4.x)
   - Gradle 7.5 (سازگار با AGP 7.4.x)
4. Workflow باید Android SDK Command-line Tools (ویندوز، آخرین نسخه رسمی) را دانلود کند
5. Workflow باید Platform-tools نسخه‌های متعدد را دانلود کند:
   - Platform-tools r35.0.1 (آخرین)
   - Platform-tools r34.0.5 (پایدار)
   - Platform-tools r33.0.2 (سازگار با API 33)
6. Workflow باید Build-tools نسخه‌های متعدد را دانلود کند:
   - Build-tools 34.0.3 (آخرین)
   - Build-tools 33.0.2 (سازگار با API 33)
7. Workflow باید SDK Platform API 33 (revision r03) را دانلود کند
8. Workflow باید SDK Platform API 30 (revision r03) را دانلود کند
9. Workflow باید SDK Platform API 27 (revision r03) را دانلود کند
10. Workflow باید Android Emulator system image API 33 (x86_64 Google APIs r15) را دانلود کند
11. Workflow باید Android Emulator engine نسخه‌های متعدد را دانلود کند:
    - Emulator 33.x آخرین پایدار (ویندوز x64)
    - Emulator 33.1.10 (ویندوز x64)
12. Workflow باید Android M2Repository نسخه‌های متعدد را دانلود کند:
    - Android M2Repository r58 (آخرین)
    - Android M2Repository r47 (پایدار)
13. Workflow باید Google M2Repository نسخه‌های متعدد را دانلود کند:
    - Google M2Repository r202 (آخرین)
    - Google M2Repository gms_v11_3_rc05_wear_2_0_7 (پایدار)
14. Workflow باید Android Sources API 33 (revision r01) را دانلود کند
15. Workflow باید CMake نسخه‌های متعدد را دانلود کند:
    - CMake 3.23.x یا بالاتر (آخرین)
    - CMake 3.22.1 (پایدار)
16. Workflow باید Constraint Layout library نسخه‌های متعدد را دانلود کند:
    - Constraint Layout 2.1.4 یا بالاتر (آخرین)
    - Constraint Layout 2.0.4 (پایدار)
17. Workflow باید فایل‌های لایسنس Android SDK را با آخرین hash‌های رسمی ایجاد کند

### الزام ۲: اعتبارسنجی قوی فایل‌ها

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم تمام فایل‌های دانلود شده قبل از آپلود اعتبارسنجی شوند تا بتوانم به نصب آفلاین اعتماد کنم.

#### معیارهای پذیرش

1. هنگامی که فایلی دانلود می‌شود، Workflow باید اندازه فایل را با حداقل آستانه‌های مورد انتظار تأیید کند
2. هنگامی که فایل ZIP دانلود می‌شود، Workflow باید یکپارچگی ZIP را با تست unzip بررسی کند
3. Workflow باید محتوای HTML را از طریق بررسی header فایل تشخیص دهد (<html, <!DOCTYPE>)
4. اگر فایلی در اعتبارسنجی اندازه ناکام شود، آنگاه Workflow باید فوراً با پیام خطای توصیفی متوقف شود
5. اگر فایل ZIP در بررسی یکپارچگی ناکام شود، آنگاه Workflow باید فوراً با پیام خطای توصیفی متوقف شود
6. Workflow باید هر کامپوننت را قبل از ادامه به کامپوننت بعدی اعتبارسنجی کند
7. هنگامی که اعتبارسنجی ناکام می‌شود، Workflow باید نمایش دهد کدام کامپوننت ناکام شده و چرا

### الزام ۳: مدیریت Artifact های منفرد

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم هر کامپوننت به عنوان artifact جداگانه آپلود شود تا در صورت نیاز بتوانم کامپوننت‌ها را به صورت جداگانه دانلود و مدیریت کنم.

#### معیارهای پذیرش

1. Workflow باید هر کامپوننت اصلی را به عنوان GitHub artifact جداگانه آپلود کند
2. Workflow باید از نام‌های واضح و توصیفی برای هر artifact استفاده کند
3. Workflow باید اطمینان حاصل کند که نام‌های artifact با الگوهای شناسایی کامپوننت مطابقت دارند
4. Workflow باید Android Studio را به عنوان artifact "android-studio-2022.3.1" آپلود کند
5. Workflow باید JDK را به عنوان artifact "jdk-17" آپلود کند
6. Workflow باید نسخه‌های مختلف Gradle را به عنوان artifact های جداگانه آپلود کند:
   - "gradle-8.1"
   - "gradle-8.0.2"
   - "gradle-7.6.3"
   - "gradle-7.5"
7. Workflow باید نسخه‌های مختلف Platform-tools را به عنوان artifact های جداگانه آپلود کند
8. Workflow باید نسخه‌های مختلف Build-tools را به عنوان artifact های جداگانه آپلود کند
9. Workflow باید هر SDK platform را با سطح API در نام artifact آپلود کند
10. Workflow باید system image ها را با سطح API و معماری در نام artifact آپلود کند
11. Workflow باید نسخه‌های مختلف M2Repository ها را به عنوان artifact های جداگانه آپلود کند

### الزام ۴: مدیریت خطای دفاعی

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم هنگام ناکامی دانلودها پیام‌های خطای واضح دریافت کنم و دانلود سایر کامپوننت‌ها ادامه یابد تا بتوانم همه مشکلات را یکجا ببینم.

#### معیارهای پذیرش

1. هنگامی که هر دانلودی ناکام می‌شود، Workflow باید خطای واضح ثبت کند اما دانلود سایر کامپوننت‌ها را ادامه دهد
2. هنگامی که اعتبارسنجی ناکام می‌شود، Workflow باید نام کامپوننت خاصی که ناکام شده را نمایش دهد
3. هنگامی که اعتبارسنجی ناکام می‌شود، Workflow باید دلیل ناکامی (اندازه، یکپارچگی و غیره) را نمایش دهد
4. Workflow باید از فرمت پیام خطای یکسان در تمام کامپوننت‌ها استفاده کند
5. Workflow باید اندازه فایل‌ها را برای دانلودهای موفق برای اشکال‌زدایی ثبت کند
6. Workflow باید در پایان خلاصه‌ای از تمام کامپوننت‌های موفق و ناکام ارائه دهد
7. Workflow باید فقط در صورت ناکامی همه کامپوننت‌ها کاملاً متوقف شود

### الزام ۵: دانلودهای باینری مستقیم

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم تمام دانلودها فایل‌های باینری مستقیم باشند تا هیچ redirect HTML یا صفحه دانلودی وجود نداشته باشد که بتواند اتوماسیون را خراب کند.

#### معیارهای پذیرش

1. Workflow باید فقط از URL های دانلود مستقیم که محتوای باینری برمی‌گردانند استفاده کند
2. Workflow نباید از URL هایی استفاده کند که به صفحات دانلود HTML redirect می‌کنند
3. Workflow باید محتوای دانلود شده را باینری (نه HTML) از طریق اعتبارسنجی اندازه و ZIP تأیید کند
4. هنگامی که دانلود HTML به جای باینری برمی‌گرداند، Workflow باید با پیام خطای واضح ناکام شود

### الزام ۶: آستانه‌های اندازه جامع

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم بررسی‌های حداقل اندازه فایل مناسب داشته باشم تا دانلودهای ناقص یا خراب زود تشخیص داده شوند.

#### معیارهای پذیرش

1. Workflow باید حداقل اندازه ۱ گیگابایت برای دانلود Android Studio اعمال کند
2. Workflow باید حداقل اندازه ۱۰۰ مگابایت برای دانلود JDK 17 اعمال کند
3. Workflow باید حداقل اندازه ۵۰ مگابایت برای دانلود Gradle اعمال کند
4. Workflow باید حداقل اندازه ۵۰ مگابایت برای Command Line Tools اعمال کند
5. Workflow باید حداقل اندازه ۱۵ مگابایت برای Platform Tools اعمال کند
6. Workflow باید حداقل اندازه ۴۰ مگابایت برای Build Tools اعمال کند
7. Workflow باید حداقل اندازه ۲۵ مگابایت برای هر SDK Platform اعمال کند
8. Workflow باید حداقل اندازه ۵۰۰ مگابایت برای System Images اعمال کند
9. Workflow باید حداقل اندازه ۵۰ مگابایت برای فایل‌های M2Repository اعمال کند
10. Workflow باید حداقل اندازه ۱۰ مگابایت برای CMake اعمال کند
11. Workflow باید حداقل اندازه ۱۰ مگابایت برای Sources اعمال کند

### الزام ۷: تولید فایل لایسنس

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم فایل‌های لایسنس SDK به صورت خودکار ایجاد شوند تا عملیات SDK آفلاین بدون پذیرش دستی لایسنس کار کند.

#### معیارهای پذیرش

1. Workflow باید فایل android-sdk-license را با hash صحیح ایجاد کند
2. Workflow باید فایل android-sdk-preview-license را با hash صحیح ایجاد کند
3. Workflow باید فایل google-gdk-license را با hash صحیح ایجاد کند
4. Workflow باید فایل‌های لایسنس را به عنوان artifact جداگانه با نام "sdk-licenses" آپلود کند
5. Workflow باید hash‌های دقیق لایسنس رسمی Google SDK را جاسازی کند (hard-coded)

### الزام ۸: کنترل اجرای Workflow

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم workflow را به صورت دستی فعال کنم تا بتوانم کنترل کنم چه زمانی دانلودها اتفاق می‌افتند.

#### معیارهای پذیرش

1. Workflow باید از فعال‌سازی دستی از طریق workflow_dispatch پشتیبانی کند
2. Workflow باید روی Ubuntu latest runner برای یکنواختی اجرا شود

### الزام ۹: خلاصه دانلود و گزارش‌دهی

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم خلاصه واضحی از آنچه دانلود شده داشته باشم تا بتوانم کامل بودن را تأیید کنم.

#### معیارهای پذیرش

1. هنگامی که تمام دانلودها با موفقیت کامل می‌شوند، Workflow باید خلاصه جامعی نمایش دهد
2. Workflow باید تمام کامپوننت‌های دانلود شده را با نسخه‌هایشان فهرست کند
3. Workflow باید تأیید کند که تمام اعتبارسنجی‌ها موفق بوده‌اند
4. Workflow باید نشان دهد که workflow برای توسعه آفلاین اندروید آماده است
5. Workflow باید خروجی JSON قابل خواندن ماشین از تمام کامپوننت‌ها شامل نسخه، اندازه فایل و checksum تولید کند

### الزام ۱۰: سازگاری نسخه

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم نسخه‌های ابزار یکسانی داشته باشم که با هم کار می‌کنند تا هیچ مشکل سازگاری در توسعه آفلاین نداشته باشم.

#### معیارهای پذیرش

1. Workflow باید از Gradle 7.6.3 استفاده کند که با Android Studio 2022.3.1 (AGP 7.4.x) سازگار است
2. Workflow باید از Build Tools 33.0.2 استفاده کند که با target SDK API 33 مطابقت دارد
3. Workflow باید از JDK 17 استفاده کند که نسخه توصیه شده برای توسعه اندروید است
4. Workflow باید از نسخه‌های پایدار آخر تمام کامپوننت‌های SDK استفاده کند
5. Workflow باید اطمینان حاصل کند که تمام نسخه‌های کامپوننت به صراحت مشخص شده‌اند (بدون تگ‌های "latest")

### الزام ۱۱: قفل کردن Revision صریح

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم URL های SDK کاملاً نسخه‌بندی و revision-locked باشند تا دانلودها قابل پیش‌بینی و تکرارپذیر باشند.

#### معیارهای پذیرش

1. Workflow باید از URL های SDK کاملاً نسخه‌بندی و revision-locked استفاده کند
2. Workflow نباید به نام‌های مستعار قابل تغییر مانند "latest" تکیه کند
3. Workflow باید شماره revision دقیق برای تمام کامپوننت‌های SDK مشخص کند
4. Workflow باید از URL های ثابت و غیرقابل تغییر برای تمام دانلودها استفاده کند

### الزام ۱۲: اعتبارسنجی Emulator (اختیاری)

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم آرشیوهای emulator فقط از نظر ساختاری اعتبارسنجی شوند چون سیستم‌عامل هدف متفاوت است.

#### معیارهای پذیرش

1. Workflow باید آرشیوهای emulator را فقط از نظر ساختاری (یکپارچگی ZIP) اعتبارسنجی کند، نه اجرای runtime
2. Workflow باید باینری‌های emulator را دانلود کند اما اعتبارسنجی اجرا را رد کند
3. Workflow باید به وضوح مشخص کند که اعتبارسنجی emulator محدود به بررسی ساختاری است

### الزام ۱۳: Gradle Cache Seeding (اختیاری اما توصیه شده)

**داستان کاربر:** به عنوان توسعه‌دهنده، می‌خواهم cache های Gradle wrapper و dependency از پیش پر شوند تا build های واقعاً آفلاین بدون --refresh-dependencies امکان‌پذیر باشند.

#### معیارهای پذیرش

1. Workflow ممکن است cache های Gradle wrapper و dependency را از پیش پر کند
2. Workflow ممکن است ساختار پوشه ~/.gradle/wrapper/dists را آماده کند
3. Workflow ممکن است ساختار پوشه ~/.gradle/caches/modules-2 را آماده کند
4. این الزام اختیاری است اما برای تجربه آفلاین کامل توصیه می‌شود